<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>列表页</title>
    <link type="text/css" rel="stylesheet" href="css/reset.css"/>
    <link type="text/css" rel="stylesheet" href="css/category.css" />
</head>
<body>
     <!-- 顶部 -->
     <div id="head">
        <div class="header">
            <ul class="head_nav">
                <li><a href="###">首页</a></li>
                <li><a href="#">平台政策</a></li>
                <li class="border0"><a href="#">商家入驻</a></li>
            </ul>
            <ul class="head_user">
                <li><a href="login.html" class="user_login">登录</a><a href="regist.html">注册</a> </li>
                <li><a href="#">下载必要APP</a></li>
                <li class="msg_center"><a href="#">消息中心<span>0</span></a></li>
                <li class="kf_fuwu"><a href="#">客服服务<i></i></a></li>
                <li class="user_shopcar"><a href="#" >购物车<span>0</span></a></li>
            </ul>
        </div>
    </div>
    <!-- 导航 -->
    <div id="nav" >
        <div class="nav_index">
            <div class="logo">
                <h1><a href="http://www.biyao.com/home/index.html"></a></h1>
            </div>
            <div class="nav_search">
                <p>
                    <input type="text" id="searchInput" placeholder="请输入要搜索的商品" />
                    <span id="searchBtn"></span>
                </p>
               
            </div>
           
        </div>
    </div>

    <!-- 导航 首页》男装》男士内搭 -->
    <div id="bread">
        <a href="index.html">首页</a>
        <a href="#">
            <b>&gt;</b>
            男装
        </a>
        <span>
            <b>&gt;</b>
            男士内搭
        </span>
    </div>
    <!-- 分类栏 -->
    <div id="cateBread">
        <span>男士内搭：</span>
        <ul>
            <li><a href="#">T恤</a></li>
            <li><a href="#">POLO衫</a></li>
            <li><a href="#">衬衫</a></li>
            <li><a href="#">针织衫</a></li>
            <li><a href="#">卫衣</a></li>
            <li><a href="#">马甲</a></li>
        </ul>
    </div>
    <!-- 列表 -->
    <div id="catecontent">
        <!-- <ul>
            <li>
               <a href="#">
                   <img src="http://bfs.biyao.com/group1/M00/37/98/rBACYVrv4PyADUtZAAB2ynSjcvY109.jpg" />
                   <h3>hhhhhhhhhhhhhhhh</h3>
                   <p>hhhh</p>
               </a> 

            </li>
        </ul> -->
    </div>
    <table></table>
    <!-- <div id="footer">
        <div class="foot">
            <ul class="footer-serve">
                <li><img src="http://static2.biyao.com/pc/common/img/master/serve-make.png?v=biyao_af9ffe1" alt=""/><span>直连一线制造</span></li>
                <li><img src="http://static4.biyao.com/pc/common/img/master/serve-backage.png?v=biyao_e2de7c6" alt=""/><span>全品类包邮</span></li>
                <li><img src="http://static1.biyao.com/pc/common/img/master/serve-pay.png?v=biyao_77dd9d9" alt=""/><span>平台先行赔付</span></li>
                <li><img src="http://static3.biyao.com/pc/common/img/master/serve-refund.png?v=biyao_2c6f2c2" alt=""/><span>7天无忧退换货</span></li>
            </ul>
            <div class="footer-main">
                <div class="fmain_left">
                    <ul class="footlist">
                        <li>帮助中心</li>
                        <li><a href="#">平台政策</a></li>
                        <li><a href="#">商家入驻</a></li>
                    </ul>
                    <ul class="footlist">
                        <li>关注必要</li>
                        <li><a href="#">官方微信</a></li>
                        <li><a href="#">新浪微博</a></li>
                    </ul>
                    <ul class="footlist">
                        <li>关于必要</li>
                        <li><a href="#">了解必要</a></li>
                        <li><a href="#">加入必要</a></li>
                        <li><a href="#">联系我们</a></li>
                    </ul>
                    <ul class="footapp">
                        <li>下载必要APP</li>
                        <li><img src="http://static4.biyao.com/pc/common/img/master/app.png?v=biyao_41bce2f" alt=" " ></li>
                    </ul>
                </div>
                <div class="fmain_right">
                    <p>服务监督邮箱</p>
                    <p class="fmremaill">cs@biyao.com</p>
                </div>
            </div>
            <div class="footer-info">
                <p><span>Copyright © 2018, BIYAO.COM</span><span>珠海必要科技有限公司</span><span>粤网文〔2018〕0969-419号</span><span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44049102496139" target="_blank">粤公网安备44049102496139号</a></span><span><a href="http://www.miibeian.gov.cn" target="_blank">粤ICP备13088531号-2</a></span></p>
                <p><span><a href="http://static2.biyao.com/pc/www/img/footer/by_drugs.png" target="_blank">互联网药品信息服务资格证书</a></span><span><a href="http://static3.biyao.com/pc/www/img/footer/by_food.jpg" target="_blank">食品经营许可证</a></span></p>
                <p><span>公司地址：珠海市唐家湾镇哈工大路1号1栋E301-15</span><span>公司电话：0756-3635580</span></p>
                <p><span>必要商城提示您，产品“由某制造商出品”仅为陈述制造商既往生产经历，并不意味着相应产品与特定品牌产品相同或近似。</span></p>
            </div>
        </div>
    </div> -->
</body>
<script src="js/libs/jquery-3.3.1.js"></script>
<script>
    $(function(){
        // var opt = {
        //     url:"http://mce.meilishuo.com/jsonp/get/3?offset=0&frame=0&trace=0&limit=10&endId=0&pid=106888&_=1526369583128",
        //     dataType:"jsonp",
        //     data:{page:1}
        // }
        // $.ajax(opt)
        // .then(function(res){
        //     console.log(res);
        // })


       function WaterFall(url,main_select){
           if(!url || !main_select) return;
           this.url = url;
           this.main_select = $(main_select);
           this.init();
       }
       WaterFall.prototype = {
           constructor:WaterFall,
           init(){
               this.page = 1;
               this.load_data()
               .then(function(res){
                   this.json = res.data.list;
                   //console.log(res);
                   this.render_page();
                   this.sort_item();
               }.bind(this))
               .fail(function(def,type,err_msg){
                   //this.load_err();
               })
               $(document).on("scroll",$.proxy(this.is_load,this));
           },
           load_data(){
               this.opt = {
                   url:this.url,
                   dataType:"jsonp",
                   data:{page:this.page},
                   statusCode:{
                       404:function(){
                           alert("page no found");
                       },
                       403:function(){
                           alert("不允许访问！");
                       }
                   }
               };
               return $.ajax(this.opt)
           },
           render_page(){
               //拼接字符串
               this.html = "<ul>";
               this.json.forEach(function(item){
                console.log(item);
                this.html += `<li>
                                <a href="#">
                                    <img src=${item.image} />
                                    <h3>${item.title}</h3>
                                    <p>￥${item.price}</p>
                                </a> 
                                <button data-id=${item.adId}>加入购物车</button>
                             </li>`
               }.bind(this));
               this.html += "</ul>";
               this.main_select.html(this.main_select.html() + this.html);
           },
           sort_item(){
               this.children = this.main_select.find("li");
               var heightArray = [];
               for(var i = 0;i<this.children.length;i++){
                   if(i<4){
                       heightArray.push($(this.children[i]).height());  
                   }else{
                       var minHeight = Math.min.apply(false,heightArray);
                       var minIndex = heightArray.indexOf(minHeight);
                       this.children.eq(i).css({
                           position:"absolute",
                           left:this.children.eq(minIndex).position().left + 5,
                           top:minHeight += 15
                       })
                       heightArray[minIndex] = minHeight + this.children.eq(i).height();
                   }
               }
           },
           load_err(){
               alert("出现错误！");
           },
           is_load(){
               this.scrollTop = $("html,body").scrollTop();
               this.clientHeight = document.documentElement.clientHeight;
               this.lastTop = this.main_select.find("li").eq(this.main_select.find("li").length - 1).position().top;
               console.log(this.lastTop);
               this.loading = false; //是否符合加载条件
               if(this.scrollTop +this.clientHeight >= this.lastTop){
                   this.loading = true;
               }
               if(!this.loading || this.loading_msg) return 0;
               this.loading_msg = true;
               this.page ++;
               this.load_data()
               .then(function(res){
                   this.json =res.data.list;
                   this.render_page();
                   this.sort_item();
                   this.loading_msg = false;
               }.bind(this))
           }
       }
       new WaterFall("http://mce.meilishuo.com/jsonp/get/3?offset=0&frame=0&trace=0&limit=10&endId=0&pid=106888&_=1526369583128","#catecontent")
    })
</script>
</html>